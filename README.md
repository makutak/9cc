# 9cc - 自作Cコンパイラ

> **📖 参考書籍**: このコンパイラは[低レイヤを知りたい人のためのCコンパイラ作成入門](https://www.sigbus.info/compilerbook)を参考に実装されています。

9ccは教育目的で作成された小さなCコンパイラです。CのサブセットをコンパイルしてLinux x86-64アセンブリを出力します。

## 機能

### 対応している言語機能

- **データ型**: `int`, `char`, ポインタ、配列
- **演算子**:
  - 算術演算子: `+`, `-`, `*`, `/`
  - 比較演算子: `==`, `!=`, `<`, `<=`, `>`, `>=`
  - 代入演算子: `=`
  - アドレス演算子: `&`, `*`
  - `sizeof`演算子
- **制御構文**:
  - `if`文（`else`含む）
  - `while`ループ
  - `for`ループ
- **関数**: 関数定義、関数呼び出し（最大6引数）
- **変数**: ローカル変数、グローバル変数
- **配列**: 1次元・多次元配列
- **文字列リテラル**: `"hello"`
- **ブロック**: `{}`によるスコープ
- **コメント**: `//`と`/* */`
- **Statement expression**: `({ ... })`

## ビルド

```bash
make
```

## 使用方法

```bash
./9cc <input.c> > output.s
gcc -static -o program output.s
./program
```

### 例

```c
// hello.c
int main() {
    int x = 42;
    return x;
}
```

```bash
./9cc hello.c > hello.s
gcc -static -o hello hello.s
./hello
echo $?  # 42が出力される
```

## テスト

```bash
make test
```

テストは`test/test.c`に記述されており、様々なC言語の機能をテストします。

## アーキテクチャ

コンパイラは以下の段階で動作します：

1. **字句解析** (`tokenize.c`): ソースコードをトークンに分割
2. **構文解析** (`parse.c`): トークンから抽象構文木(AST)を構築
3. **型チェック** (`type.c`): ASTに型情報を付与
4. **コード生成** (`codegen.c`): ASTからx86-64アセンブリを生成

## ファイル構成

```
src/
├── 9cc.h      # ヘッダファイル（構造体、関数宣言）
├── main.c     # メインエントリーポイント
├── tokenize.c # 字句解析
├── parse.c    # 構文解析
├── type.c     # 型チェック
└── codegen.c  # コード生成

test/
├── test.sh    # テストスクリプト
└── test.c     # テスト用ファイル
```

## 制限事項

- 標準ライブラリ関数の一部のみサポート
- プリプロセッサ未対応
- 構造体・共用体未対応
- float/double型未対応
- 複雑なポインタ演算の一部制限

## 参考資料
- [低レイヤを知りたい人のためのCコンパイラ作成入門](https://www.sigbus.info/compilerbook) - Rui Ueyama氏によるコンパイラ作成チュートリアル
